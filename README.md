# CGPTS Telegram-WhatsApp Bot

בוט טלגרם המתחבר לוואטסאפ Web לניהול ופרסום נסיעות בקבוצות.

## תכונות

- 🤖 בוט טלגרם עם תפריט ידידותי בעברית
- 📱 חיבור לוואטסאפ Web
- 🚗 פרסום נסיעות בקבוצות מרובות
- 👥 ניהול קבוצות וואטסאפ
- ⚡ שליטה על קצב שליחת הודעות
- 🧹 ניקוי צ'אטים
- 🔐 מערכת אימות משתמשים
- 📊 מסד נתונים SQLite
- 📋 לוגים מפורטים

## דרישות מערכת

- Node.js 18.0.0 או גרסה חדשה יותר
- npm או yarn
- חשבון טלגרם עם בוט token
- מכשיר עם וואטסאפ לסריקת QR

## התקנה

1. **שיבוט הפרויקט:**
   ```bash
   git clone https://github.com/CGPTS/CGPTS.git
   cd CGPTS
   ```

2. **התקנת תלויות:**
   ```bash
   npm install
   ```

3. **הגדרת משתני סביבה:**
   ```bash
   cp .env.example .env
   ```
   
   ערוך את קובץ `.env` והגדר את הערכים הנדרשים:
   ```
   TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
   ```

4. **יצירת בוט טלגרם:**
   - שלח הודעה ל-@BotFather בטלגרם
   - צור בוט חדש עם הפקודה `/newbot`
   - העתק את ה-token והכנס אותו ב-.env

## הפעלה

### בפיתוח:
```bash
npm run dev
```

### בייצור:
```bash
npm run build
npm start
```

## שימוש

1. **התחלת השימוש:**
   - שלח `/start` לבוט בטלגרם
   - סרוק את קוד ה-QR שמופיע בקונסול עם וואטסאפ

2. **תפריט ראשי:**
   - 🚗 **פרסום נסיעה** - פרסם נסיעה בקבוצות שנבחרו
   - 👥 **ניהול קבוצות** - הוסף/הסר קבוצות וואטסאפ
   - ⚡ **שינוי קצב שליחה** - קבע זמן המתנה בין הודעות
   - 🧹 **ניקוי צ'אטים** - נקה הודעות מקבוצות
   - 🔄 **איתחול** - אתחל את החיבור לוואטסאפ
   - 🚪 **התנתקות** - התנתק מוואטסאפ

3. **פקודות נוספות:**
   - `/help` - הצג עזרה מפורטת
   - `/status` - בדוק סטטוס המערכת
   - `/menu` - הצג תפריט ראשי

## API Endpoints

- `GET /health` - בדיקת בריאות המערכת
- `GET /status` - סטטוס מפורט של כל הרכיבים
- `GET /qr` - קוד QR עבור חיבור וואטסאפ

## מבנה הפרויקט

```
src/
├── bot/
│   └── telegram.ts      # ניהול בוט הטלגרם
├── whatsapp/
│   └── client.ts        # חיבור לוואטסאפ
├── database/
│   └── database.ts      # ניהול מסד נתונים
├── config/
│   └── config.ts        # הגדרות המערכת
├── types/
│   └── types.ts         # הגדרות טיפוסים
├── utils/
│   └── logger.ts        # מערכת לוגים
└── index.ts             # נקודת כניסה ראשית
```

## הגדרות מתקדמות

### הגבלת גישה למשתמשים
הוסף משתמשים מורשים ב-.env:
```
ALLOWED_USERS=123456789,987654321
```

### הגדרות וואטסאפ
```
WHATSAPP_HEADLESS=true          # ריצה ללא חלון דפדפן
WHATSAPP_DEVTOOLS=false         # כלי פיתוח
WHATSAPP_SESSION_PATH=./session # מיקום נתוני ההתחברות
```

### הגדרות מסד נתונים
```
DATABASE_PATH=./database.sqlite # מיקום קובץ מסד הנתונים
```

### הגדרות אפליקציה
```
PORT=3000                # פורט לשרת HTTP
LOG_LEVEL=info          # רמת לוגים (error, warn, info, debug)
MAX_RETRIES=3           # מספר ניסיונות חוזרים
DEFAULT_SEND_RATE=5000  # זמן המתנה ברירת מחדל (אלפיות שנייה)
```

## פתרון בעיות

### בעיות חיבור וואטסאפ
- ודא שוואטסאפ Web פעיל במכשיר
- סרוק מחדש את קוד ה-QR
- השתמש באיתחול (`🔄 איתחול`)

### שגיאות בוט טלגרם
- בדוק שה-token תקין
- ודא שהבוט קיבל הודעות בטלגרם
- בדוק את הלוגים בקובץ `logs/error.log`

### בעיות מסד נתונים
- ודא הרשאות כתיבה בתיקייה
- בדוק שיש די מקום בדיסק
- בדוק את הלוגים לשגיאות SQL

## תרומה לפרויקט

1. Fork הפרויקט
2. צור branch חדש לתכונה שלך
3. Commit השינויים
4. Push ל-branch
5. צור Pull Request

## רישיון

MIT License - ראה קובץ LICENSE לפרטים.

## תמיכה

לתמיכה וייעוץ:
- צור Issue בפרויקט
- צור קשר דרך Telegram: [@CGPTSol](https://t.me/CGPTSol)

---

**הערות חשובות:**
- השתמש בבוט באחריות ובהתאם לתנאי השימוש של טלגרם ووואטסאפ
- קצב שליחה מומלץ: מינימום 5 שניות בין הודעות
- הבוט שומר נתונים מקומיים - גבה בקביעות